<ion-header [translucent]="true" class="custom-header">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Configurar Ejercicio</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="guardarCambios()" [disabled]="!ejercicioSeleccionado || guardando" color="success">
        <ion-icon name="checkmark" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="main-content">
  
  <!-- Spinner overlay -->
  <div *ngIf="guardando" class="spinner-overlay">
    <div class="spinner-container">
      <ion-spinner name="crescent" color="success"></ion-spinner>
      <p>Guardando cambios...</p>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent" color="success"></ion-spinner>
    <p>Cargando...</p>
  </div>

  <div *ngIf="!loading" class="content-wrapper">
    
    <!-- Selección de ejercicio -->
    <ion-card class="seccion-card">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="barbell-outline"></ion-icon>
          Ejercicio
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        
        <!-- Ejercicio seleccionado -->
        <div *ngIf="ejercicioSeleccionado && !mostrandoLista" class="ejercicio-seleccionado" (click)="toggleListaEjercicios()">
          <div class="ejercicio-info">
            <h3>{{ ejercicioSeleccionado.nombre }}</h3>
            <div class="meta">
              <ion-chip color="success" size="small">
                <ion-icon name="body-outline"></ion-icon>
                <ion-label>{{ ejercicioSeleccionado.musculo_principal }}</ion-label>
              </ion-chip>
              <ion-chip *ngIf="ejercicioSeleccionado.categoria" color="medium" size="small">
                <ion-label>{{ ejercicioSeleccionado.categoria }}</ion-label>
              </ion-chip>
            </div>
          </div>
          <ion-button fill="clear" color="primary">
            <ion-icon name="swap-horizontal-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>

        <!-- Placeholder cuando no hay ejercicio -->
        <div *ngIf="!ejercicioSeleccionado && !mostrandoLista" class="placeholder" (click)="toggleListaEjercicios()">
          <ion-icon name="add-circle-outline"></ion-icon>
          <span>Seleccionar ejercicio</span>
        </div>

        <!-- Lista de ejercicios -->
        <div *ngIf="mostrandoLista" class="lista-ejercicios">
          <ion-searchbar 
            [(ngModel)]="filtroEjercicio"
            (ionInput)="filtrarEjercicios()"
            placeholder="Buscar ejercicio..."
            debounce="300"
            class="custom-searchbar">
          </ion-searchbar>

          <div class="ejercicios-scroll">
            <div 
              *ngFor="let ejercicio of ejerciciosDisponiblesFiltrados"
              class="ejercicio-item"
              [class.seleccionado]="ejercicioSeleccionado?.id === ejercicio.id"
              (click)="seleccionarEjercicio(ejercicio)">
              <div class="ejercicio-icon">
                <ion-icon name="barbell"></ion-icon>
              </div>
              <div class="ejercicio-info">
                <h4>{{ ejercicio.nombre }}</h4>
                <p>{{ ejercicio.musculo_principal }}</p>
              </div>
              <ion-icon *ngIf="ejercicioSeleccionado?.id === ejercicio.id" name="checkmark-circle" color="success"></ion-icon>
            </div>

            <div *ngIf="ejerciciosDisponiblesFiltrados.length === 0" class="no-results">
              <ion-icon name="search-outline"></ion-icon>
              <p>No se encontraron ejercicios</p>
            </div>
          </div>
        </div>

      </ion-card-content>
    </ion-card>

    <!-- Configuración de parámetros -->
    <ion-card class="seccion-card" *ngIf="ejercicioSeleccionado">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="settings-outline"></ion-icon>
          Configuración
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        
        <!-- Series -->
        <div class="input-group">
          <label>
            <ion-icon name="repeat-outline"></ion-icon>
            Series
          </label>
          <ion-input
            type="number"
            [(ngModel)]="series"
            placeholder="Ej: 3"
            min="1"
            class="custom-input">
          </ion-input>
        </div>

        <!-- Repeticiones -->
        <div class="input-group">
          <label>
            <ion-icon name="fitness-outline"></ion-icon>
            Repeticiones
          </label>
          <ion-input
            type="number"
            [(ngModel)]="repeticiones"
            placeholder="Ej: 12"
            min="1"
            class="custom-input">
          </ion-input>
        </div>

        <!-- Descanso -->
        <div class="input-group">
          <label>
            <ion-icon name="timer-outline"></ion-icon>
            Descanso (segundos)
          </label>
          <ion-input
            type="number"
            [(ngModel)]="descansoSegundos"
            placeholder="Ej: 60"
            min="0"
            class="custom-input">
          </ion-input>
        </div>

        <!-- Porcentaje de Fuerza -->
        <div class="input-group">
          <label>
            <ion-icon name="flash-outline"></ion-icon>
            Porcentaje de Fuerza (0-200%)
          </label>
          <ion-input
            type="number"
            [(ngModel)]="porcentajeFuerza"
            placeholder="Ej: 100"
            min="0"
            max="200"
            class="custom-input">
          </ion-input>
        </div>

      </ion-card-content>
    </ion-card>

    <!-- Botón guardar -->
    <div class="actions" *ngIf="ejercicioSeleccionado">
      <ion-button expand="block" (click)="guardarCambios()" class="btn-guardar">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Guardar Cambios
      </ion-button>
    </div>

  </div>

  <!-- Spinner overlay -->
  <div *ngIf="mostrarSpinner" class="spinner-overlay-transparent">
    <app-spinner></app-spinner>
  </div>

</ion-content>
