<ion-header>
  <ion-toolbar>
    <ion-title class="ion-text-center">Registro - Paso {{currentStep}} de {{totalSteps}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="register-container">

    <!-- Toolbar visual dentro del contenido -->
    <div class="content-toolbar" role="banner">
      <div class="toolbar-left">
        <!-- Sin botón de volver aquí -->
      </div>
      <div class="toolbar-center">
        <h1 class="toolbar-title">Crear cuenta</h1>
        <div class="toolbar-sub">Rápido • Seguro • Personalizado</div>
      </div>
      <div class="toolbar-right"></div>
    </div>

  <!-- Paso 1: Información Personal -->
  <ion-card *ngIf="currentStep === 1" [class]="animationClass" class="step-container">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="person-outline"></ion-icon>
        Información Personal
      </ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <ion-list>
        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.nombre"
              name="nombre"
              type="text" 
              placeholder="Tu nombre"
              autocomplete="given-name"
              autocapitalize="words"
              (input)="onInputChange('nombre', $event)"
              (focus)="onInputFocus('nombre')"
              (blur)="onInputBlur('nombre')"
              required>
            <label class="floating-label" [class.active]="cliente.nombre.length > 0">Nombre </label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.apellido"
              name="apellido"
              type="text" 
              placeholder="Tu apellido"
              autocomplete="family-name"
              autocapitalize="words"
              (input)="onInputChange('apellido', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.apellido.length > 0">Apellido </label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.edad"
              name="edad"
              type="number" 
              placeholder="Años"
              min="13"
              max="100"
              inputmode="numeric"
              (input)="onInputChange('edad', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.edad > 0">Edad </label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.correo"
              name="correo"
              type="email" 
              placeholder="nombre@cliente.com"
              autocomplete="email"
              autocapitalize="none"
              inputmode="email"
              (input)="onInputChange('correo', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.correo.length > 0">Correo Electrónico</label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.password"
              name="password"
              type="password" 
              placeholder="Mínimo 6 caracteres"
              autocomplete="new-password"
              (input)="onInputChange('password', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.password.length > 0">Contraseña</label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <select 
              class="native-select"
              [(ngModel)]="cliente.genero"
              name="genero"
              (change)="onInputChange('genero', $event)"
              required>
              <option value="">Seleccionar género</option>
              <option value="M">Hombre</option>
              <option value="F">Mujer</option>
            </select>
            <label class="floating-label" [class.active]="cliente.genero">Género</label>
          </div>
        </ion-item>
      </ion-list>

      <div class="step-buttons">
        <ion-button class="next-button" (click)="nextStep()" [disabled]="!isStep1Valid()">
          <ion-icon name="arrow-forward" slot="start"></ion-icon>
          Siguiente
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Paso 2: Información Física -->
  <ion-card *ngIf="currentStep === 2" [class]="animationClass" class="step-container physical-info">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="fitness-outline"></ion-icon>
        Información Física
      </ion-card-title>
      <ion-card-subtitle>Datos sobre tu estado físico</ion-card-subtitle>
    </ion-card-header>
    
    <ion-card-content class="physical-content">
      <ion-list>
        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.peso"
              name="peso"
              type="number" 
              placeholder="70"
              min="30"
              max="300"
              inputmode="numeric"
              (input)="onInputChange('peso', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.peso > 0">Peso (kg) *</label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.altura"
              name="altura"
              type="number" 
              placeholder="170"
              min="100"
              max="250"
              inputmode="numeric"
              (input)="onInputChange('altura', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.altura > 0">Altura (cm) *</label>
          </div>
        </ion-item>

        <!-- Objetivos múltiples -->
        <ion-item>
          <div class="checkbox-group">
            <label class="section-label">Objetivos Fitness * (puedes elegir varios)</label>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-peso" 
                [(ngModel)]="objetivos.bajarPeso"
                name="objetivo-peso"
                (change)="updateObjetivos()">
              <label for="objetivo-peso">Bajar de peso</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-masa" 
                [(ngModel)]="objetivos.aumentarMasa"
                name="objetivo-masa"
                (change)="updateObjetivos()">
              <label for="objetivo-masa">Aumentar masa muscular</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-fuerza" 
                [(ngModel)]="objetivos.mejorarFuerza"
                name="objetivo-fuerza"
                (change)="updateObjetivos()">
              <label for="objetivo-fuerza">Mejorar fuerza</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-resistencia" 
                [(ngModel)]="objetivos.mejorarResistencia"
                name="objetivo-resistencia"
                (change)="updateObjetivos()">
              <label for="objetivo-resistencia">Mejorar resistencia</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-salud" 
                [(ngModel)]="objetivos.mejorarSalud"
                name="objetivo-salud"
                (change)="updateObjetivos()">
              <label for="objetivo-salud">Mejorar salud general</label>
            </div>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <select 
              class="native-select"
              [(ngModel)]="cliente.nivelActividad"
              name="nivelActividad"
              (change)="onInputChange('nivelActividad', $event)"
              required>
              <option value="">Seleccionar nivel</option>
              <option value="Bajo">Baja (Sedentario)</option>
              <option value="Medio">Media (Ejercicio ocasional)</option>
              <option value="Alto">Alta (Ejercicio regular)</option>
            </select>
            <label class="floating-label" [class.active]="cliente.nivelActividad">Nivel de Actividad *</label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.horasSueno"
              name="horasSueno"
              type="text" 
              placeholder="Ej: 7-8 horas"
              (input)="onInputChange('horasSueno', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.horasSueno.length > 0">Horas de Sueño *</label>
          </div>
        </ion-item>
      </ion-list>

      <div class="step-buttons">
        <ion-button class="back-button" (click)="prevStep()">
          <ion-icon name="arrow-back" slot="start"></ion-icon>
          Anterior
        </ion-button>
        <ion-button class="next-button" (click)="nextStep()" [disabled]="!isStep2Valid()">
          <ion-icon name="arrow-forward" slot="end"></ion-icon>
          Siguiente
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Paso 3: Información Médica -->
  <ion-card *ngIf="currentStep === 3" [class]="animationClass" class="step-container medical-info">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="medical-outline"></ion-icon>
        Información Médica
      </ion-card-title>
      <ion-card-subtitle>Ayúdanos a personalizar tu entrenamiento</ion-card-subtitle>
    </ion-card-header>
    
    <ion-card-content class="medical-content">`
      <ion-list>
        <!-- Enfermedad Crónica -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tienes alguna enfermedad crónica?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="enfermedadCronica"
                [(ngModel)]="cliente.enfermedadCronica"
                name="enfermedadCronica"
                (change)="onInputChange('enfermedadCronica', $event)"
                class="toggle-input">
              <label for="enfermedadCronica" class="toggle-label">
                <span class="toggle-text">{{cliente.enfermedadCronica ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.enfermedadCronica">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionEnfermedad"
              name="descripcionEnfermedad"
              placeholder="Explica brevemente tu condición..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionEnfermedad', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionEnfermedad && cliente.descripcionEnfermedad.length > 0">Describe tu condición</label>
            <div class="char-counter">{{(cliente.descripcionEnfermedad || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Diabetes -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tienes diabetes?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="diabetes"
                [(ngModel)]="cliente.diabetes"
                name="diabetes"
                (change)="onInputChange('diabetes', $event)"
                class="toggle-input">
              <label for="diabetes" class="toggle-label">
                <span class="toggle-text">{{cliente.diabetes ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Hipotensión -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tienes hipotensión?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="hipotension"
                [(ngModel)]="cliente.hipotension"
                name="hipotension"
                (change)="onInputChange('hipotension', $event)"
                class="toggle-input">
              <label for="hipotension" class="toggle-label">
                <span class="toggle-text">{{cliente.hipotension ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Hipotiroide -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tienes hipotiroide?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="hipotiroide"
                [(ngModel)]="cliente.hipotiroide"
                name="hipotiroide"
                (change)="onInputChange('hipotiroide', $event)"
                class="toggle-input">
              <label for="hipotiroide" class="toggle-label">
                <span class="toggle-text">{{cliente.hipotiroide ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Hipotiroidismo -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tienes hipotiroidismo?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="hipotiroidismo"
                [(ngModel)]="cliente.hipotiroidismo"
                name="hipotiroidismo"
                (change)="onInputChange('hipotiroidismo', $event)"
                class="toggle-input">
              <label for="hipotiroidismo" class="toggle-label">
                <span class="toggle-text">{{cliente.hipotiroidismo ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Medicación Regular -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tomas medicación regular?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="medicacionRegular"
                [(ngModel)]="cliente.medicacionRegular"
                name="medicacionRegular"
                (change)="onInputChange('medicacionRegular', $event)"
                class="toggle-input">
              <label for="medicacionRegular" class="toggle-label">
                <span class="toggle-text">{{cliente.medicacionRegular ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.medicacionRegular">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionMedicacion"
              name="descripcionMedicacion"
              placeholder="Lista tus medicamentos..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionMedicacion', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionMedicacion && cliente.descripcionMedicacion.length > 0">¿Qué medicamentos tomas?</label>
            <div class="char-counter">{{(cliente.descripcionMedicacion || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Cirugías -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Has tenido cirugías?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="cirugias"
                [(ngModel)]="cliente.cirugias"
                name="cirugias"
                (change)="onInputChange('cirugias', $event)"
                class="toggle-input">
              <label for="cirugias" class="toggle-label">
                <span class="toggle-text">{{cliente.cirugias ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.cirugias">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionCirugias"
              name="descripcionCirugias"
              placeholder="Explica qué cirugías has tenido..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionCirugias', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionCirugias && cliente.descripcionCirugias.length > 0">Describe las cirugías</label>
            <div class="char-counter">{{(cliente.descripcionCirugias || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Lesiones -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Tienes lesiones actuales?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="lesiones"
                [(ngModel)]="cliente.lesiones"
                name="lesiones"
                (change)="onInputChange('lesiones', $event)"
                class="toggle-input">
              <label for="lesiones" class="toggle-label">
                <span class="toggle-text">{{cliente.lesiones ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.lesiones">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionLesiones"
              name="descripcionLesiones"
              placeholder="Explica tus lesiones actuales..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionLesiones', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionLesiones && cliente.descripcionLesiones.length > 0">Describe las lesiones</label>
            <div class="char-counter">{{(cliente.descripcionLesiones || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Fumar -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Fumas regularmente?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="fuma"
                [(ngModel)]="cliente.fuma"
                name="fuma"
                (change)="onInputChange('fuma', $event)"
                class="toggle-input">
              <label for="fuma" class="toggle-label">
                <span class="toggle-text">{{cliente.fuma ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Alcohol -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¿Consumes alcohol regularmente?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="alcohol"
                [(ngModel)]="cliente.alcohol"
                name="alcohol"
                (change)="onInputChange('alcohol', $event)"
                class="toggle-input">
              <label for="alcohol" class="toggle-label">
                <span class="toggle-text">{{cliente.alcohol ? 'Sí' : 'No'}}</span>
              </label>
            </div>
          </div>
        </ion-item>
      </ion-list>

      <div class="step-buttons">
        <ion-button class="back-button" (click)="prevStep()">
          <ion-icon name="arrow-back" slot="start"></ion-icon>
          Anterior
        </ion-button>
        <ion-button class="next-button" (click)="nextStep()">
          <ion-icon name="arrow-forward" slot="end"></ion-icon>
          Siguiente
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Paso 4: Confirmación -->
  <ion-card *ngIf="currentStep === 4" [class]="animationClass" class="step-container">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="checkmark-circle-outline"></ion-icon>
        Confirmar Registro
      </ion-card-title>
      <ion-card-subtitle>Revisa tu información</ion-card-subtitle>
    </ion-card-header>
    
    <ion-card-content>
      <!-- Información Personal -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Información Personal</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Nombre:</strong> {{cliente.nombre}} {{cliente.apellido}}</p>
          <p><strong>Edad:</strong> {{cliente.edad}} años</p>
          <p><strong>Email:</strong> {{cliente.correo}}</p>
          <p><strong>Género:</strong> {{cliente.genero === 'M' ? 'Masculino' : 'Femenino'}}</p>
        </ion-card-content>
      </ion-card>

      <!-- Información Física -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Información Física</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Peso:</strong> {{cliente.peso}} kg</p>
          <p><strong>Altura:</strong> {{cliente.altura}} cm</p>
          <p><strong>Objetivo:</strong> {{cliente.objetivo}}</p>
          <p><strong>Nivel de Actividad:</strong> {{cliente.nivelActividad}}</p>
          <p><strong>Horas de Sueño:</strong> {{cliente.horasSueno}}</p>
        </ion-card-content>
      </ion-card>

      <!-- Condiciones Médicas -->
      <ion-card *ngIf="hasHealthConditions()">
        <ion-card-header>
          <ion-card-title>Condiciones Médicas</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p *ngIf="cliente.enfermedadCronica">✅ Enfermedad Crónica: {{cliente.descripcionEnfermedad}}</p>
          <p *ngIf="cliente.diabetes">✅ Diabetes</p>
          <p *ngIf="cliente.hipotension">✅ Hipotensión</p>
          <p *ngIf="cliente.hipotiroide">✅ Hipotiroide</p>
          <p *ngIf="cliente.hipotiroidismo">✅ Hipotiroidismo</p>
          <p *ngIf="cliente.medicacionRegular">✅ Medicación: {{cliente.descripcionMedicacion}}</p>
          <p *ngIf="cliente.cirugias">✅ Cirugías: {{cliente.descripcionCirugias}}</p>
          <p *ngIf="cliente.lesiones">✅ Lesiones: {{cliente.descripcionLesiones}}</p>
          <p *ngIf="cliente.fuma">✅ Fumador</p>
          <p *ngIf="cliente.alcohol">✅ Consumo de alcohol</p>
        </ion-card-content>
      </ion-card>

      <div class="step-buttons">
        <ion-button class="back-button" (click)="prevStep()">
          <ion-icon name="arrow-back" slot="start"></ion-icon>
          Anterior
        </ion-button>
        <ion-button 
          class="next-button" 
          (click)="onSubmit()" 
          [disabled]="isSubmitting">
          <ion-spinner *ngIf="isSubmitting" name="crescent" slot="start"></ion-spinner>
          <ion-icon *ngIf="!isSubmitting" name="checkmark" slot="start"></ion-icon>
          {{isSubmitting ? 'Registrando...' : 'Completar'}}
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Pantalla de Éxito -->
  <ion-card *ngIf="showSuccess">
    <ion-card-content class="ion-text-center">
      <ion-icon name="checkmark-circle" color="success" style="font-size: 4rem;"></ion-icon>
      <h2>¡Registro Exitoso!</h2>
      <p>Tu cuenta ha sido creada correctamente.</p>
      <p>Tu código QR se generará automáticamente.</p>
      
      <ion-button expand="full" (click)="goToLogin()" color="success">
        <ion-icon name="log-in" slot="start"></ion-icon>
        Ir al Login
      </ion-button>
    </ion-card-content>
  </ion-card>

  </div>
</ion-content>