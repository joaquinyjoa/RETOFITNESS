<ion-header>
  <ion-toolbar>
    <ion-title class="ion-text-center">Registro - Paso {{currentStep}} de {{totalSteps}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="register-container">

    <!-- Toolbar visual dentro del contenido -->
    <div class="content-toolbar" role="banner">
      <div class="toolbar-left">
        <!-- Sin bot√≥n de volver aqu√≠ -->
      </div>
      <div class="toolbar-center">
        <h1 class="toolbar-title">Crear cuenta</h1>
        <div class="toolbar-sub">R√°pido ‚Ä¢ Seguro ‚Ä¢ Personalizado</div>
      </div>
      <div class="toolbar-right"></div>
    </div>

  <!-- Paso 1: Informaci√≥n Personal -->
  <ion-card *ngIf="currentStep === 1" [class]="animationClass" class="step-container">
    <ion-card-header>
      <ion-card-title>
        üë§ Informaci√≥n Personal
      </ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <ion-list>
        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.nombre"
              name="nombre"
              type="text" 
              placeholder="Tu nombre"
              autocomplete="given-name"
              autocapitalize="words"
              (input)="onInputChange('nombre', $event)"
              (blur)="onInputBlur('nombre')"
              (focus)="onInputFocus('nombre')"
              required>
            <label class="floating-label" [class.active]="cliente.nombre.length > 0">Nombre</label>
          </div>
        </ion-item>
        <div class="error-message" *ngIf="validationErrors.nombre">
          {{ validationErrors.nombre }}
        </div>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.apellido"
              name="apellido"
              type="text" 
              placeholder="Tu apellido"
              autocomplete="family-name"
              autocapitalize="words"
              (input)="onInputChange('apellido', $event)"
              (blur)="onInputBlur('apellido')"
              required>
            <label class="floating-label" [class.active]="cliente.apellido.length > 0">Apellido </label>
          </div>
        </ion-item>
        <div class="error-message" *ngIf="validationErrors.apellido">
          {{ validationErrors.apellido }}
        </div>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.edad"
              name="edad"
              type="number" 
              placeholder="A√±os"
              min="10"
              max="80"
              inputmode="numeric"
              (input)="onInputChange('edad', $event)"
              (blur)="onInputBlur('edad')"
              required>
            <label class="floating-label" [class.active]="cliente.edad > 0">Edad </label>
          </div>
        </ion-item>
        <div class="error-message" *ngIf="validationErrors.edad">
          {{ validationErrors.edad }}
        </div>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.correo"
              name="correo"
              type="email" 
              placeholder="nombre@retofitness.com"
              autocomplete="email"
              autocapitalize="none"
              inputmode="email"
              (input)="onInputChange('correo', $event)"
              (blur)="onInputBlur('correo')"
              required>
            <label class="floating-label" [class.active]="cliente.correo.length > 0">Correo Electr√≥nico</label>
          </div>
        </ion-item>
        <div class="error-message" *ngIf="validationErrors.correo">
          {{ validationErrors.correo }}
        </div>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.password"
              name="password"
              type="password" 
              placeholder="M√≠nimo 6 caracteres con letras y n√∫meros"
              autocomplete="new-password"
              (input)="onInputChange('password', $event)"
              (blur)="onInputBlur('password')"
              required>
            <label class="floating-label" [class.active]="cliente.password.length > 0">Contrase√±a</label>
          </div>
        </ion-item>
        <div class="error-message" *ngIf="validationErrors.password">
          {{ validationErrors.password }}
        </div>

        <ion-item>
          <div class="input-wrapper">
            <select 
              class="native-select"
              [(ngModel)]="cliente.genero"
              name="genero"
              (change)="onInputChange('genero', $event)"
              (blur)="onInputBlur('genero')"
              required>
              <option value="">Seleccionar g√©nero</option>
              <option value="Hombre">Hombre</option>
              <option value="Mujer">Mujer</option>
              <option value="Otro">Otro</option>
            </select>
            <label class="floating-label" [class.active]="cliente.genero">G√©nero</label>
          </div>
        </ion-item>
        <div class="error-message" *ngIf="validationErrors.genero">
          {{ validationErrors.genero }}
        </div>
      </ion-list>

      

      <div class="step-buttons">
        <ion-button class="next-button" (click)="nextStep()" [disabled]="!isStep1Valid()">
          Siguiente
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Paso 2: Informaci√≥n F√≠sica -->
  <ion-card *ngIf="currentStep === 2" [class]="animationClass" class="step-container physical-info">
    <ion-card-header>
      <ion-card-title>
       üí™ Informaci√≥n F√≠sica
      </ion-card-title>
    </ion-card-header>
    
    <ion-card-content class="physical-content">
      <ion-list>
        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.peso"
              name="peso"
              type="number" 
              placeholder="70"
              min="30"
              max="300"
              inputmode="numeric"
              (input)="onInputChange('peso', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.peso > 0">Peso (kg) *</label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.altura"
              name="altura"
              type="number" 
              placeholder="170"
              min="100"
              max="250"
              inputmode="numeric"
              (input)="onInputChange('altura', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.altura > 0">Altura (cm) *</label>
          </div>
        </ion-item>

        <!-- Objetivos m√∫ltiples -->
        <ion-item>
          <div class="checkbox-group">
            <label class="section-label">Objetivos Fitness (opcional - puedes elegir varios)</label>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-peso" 
                [(ngModel)]="objetivos.bajarPeso"
                name="objetivo-peso"
                (change)="updateObjetivos()">
              <label for="objetivo-peso">Bajar de peso</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-masa" 
                [(ngModel)]="objetivos.aumentarMasa"
                name="objetivo-masa"
                (change)="updateObjetivos()">
              <label for="objetivo-masa">Aumentar masa muscular</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-fuerza" 
                [(ngModel)]="objetivos.mejorarFuerza"
                name="objetivo-fuerza"
                (change)="updateObjetivos()">
              <label for="objetivo-fuerza">Mejorar fuerza</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-resistencia" 
                [(ngModel)]="objetivos.mejorarResistencia"
                name="objetivo-resistencia"
                (change)="updateObjetivos()">
              <label for="objetivo-resistencia">Mejorar resistencia</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-salud" 
                [(ngModel)]="objetivos.mejorarSalud"
                name="objetivo-salud"
                (change)="updateObjetivos()">
              <label for="objetivo-salud">Mejorar salud general</label>
            </div>
            
            <div class="checkbox-option">
              <input 
                type="checkbox" 
                id="objetivo-otro" 
                [(ngModel)]="objetivos.otro"
                name="objetivo-otro"
                (change)="updateObjetivos()">
              <label for="objetivo-otro">Otro</label>
            </div>
            
            <!-- Campo de texto para objetivo personalizado -->
            <div class="input-wrapper" *ngIf="objetivos.otro" style="margin-top: 10px;">
              <input 
                class="native-input"
                [(ngModel)]="objetivoOtro"
                name="objetivoOtro"
                type="text" 
                placeholder="Especifica tu objetivo"
                (input)="updateObjetivos()"
                maxlength="100">
              <label class="floating-label" [class.active]="objetivoOtro.length > 0"></label>
            </div>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <select 
              class="native-select"
              [(ngModel)]="cliente.nivelActividad"
              name="nivelActividad"
              (change)="onInputChange('nivelActividad', $event)"
              required>
              <option value="Bajo">Baja (Sedentario)</option>
              <option value="Medio">Media (Ocasional)</option>
              <option value="Alto">Alta (Regular)</option>
            </select>
            <label class="floating-label" [class.active]="cliente.nivelActividad">Nivel de Actividad *</label>
          </div>
        </ion-item>

        <ion-item>
          <div class="input-wrapper">
            <input 
              class="native-input"
              [(ngModel)]="cliente.horasSueno"
              name="horasSueno"
              type="text" 
              placeholder="Ej: 7-8 horas"
              (input)="onInputChange('horasSueno', $event)"
              required>
            <label class="floating-label" [class.active]="cliente.horasSueno.length > 0">Horas de Sue√±o *</label>
          </div>
        </ion-item>
      </ion-list>

      <div class="step-buttons">
        <ion-button class="back-button" (click)="prevStep()">
          Anterior
        </ion-button>
        <ion-button class="next-button" (click)="nextStep()" [disabled]="!isStep2Valid()">
          Siguiente
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Paso 3: Informaci√≥n M√©dica -->
  <ion-card *ngIf="currentStep === 3" [class]="animationClass" class="step-container medical-info">
    <ion-card-header>
      <ion-card-title>
        ü©∫ Informaci√≥n M√©dica
      </ion-card-title>
    </ion-card-header>

    <ion-card-content class="medical-content">
      <ion-list>
        <!-- Enfermedad Cr√≥nica -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTienes alguna enfermedad cr√≥nica?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="enfermedadCronica"
                [(ngModel)]="cliente.enfermedadCronica"
                name="enfermedadCronica"
                (change)="onInputChange('enfermedadCronica', $event)"
                class="toggle-input">
              <label for="enfermedadCronica" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.enfermedadCronica">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionEnfermedad"
              name="descripcionEnfermedad"
              placeholder="Explica brevemente tu condici√≥n..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionEnfermedad', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionEnfermedad && cliente.descripcionEnfermedad.length > 0"></label>
            <div class="char-counter">{{(cliente.descripcionEnfermedad || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Diabetes -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTienes diabetes?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="diabetes"
                [(ngModel)]="cliente.diabetes"
                name="diabetes"
                (change)="onInputChange('diabetes', $event)"
                class="toggle-input">
              <label for="diabetes" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Hipotensi√≥n -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTienes hipotensi√≥n?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="hipotension"
                [(ngModel)]="cliente.hipotension"
                name="hipotension"
                (change)="onInputChange('hipotension', $event)"
                class="toggle-input">
              <label for="hipotension" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Hipotiroide -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTienes hipotiroide?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="hipotiroide"
                [(ngModel)]="cliente.hipotiroide"
                name="hipotiroide"
                (change)="onInputChange('hipotiroide', $event)"
                class="toggle-input">
              <label for="hipotiroide" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Hipotiroidismo -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTienes hipotiroidismo?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="hipotiroidismo"
                [(ngModel)]="cliente.hipotiroidismo"
                name="hipotiroidismo"
                (change)="onInputChange('hipotiroidismo', $event)"
                class="toggle-input">
              <label for="hipotiroidismo" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Medicaci√≥n Regular -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTomas medicaci√≥n?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="medicacionRegular"
                [(ngModel)]="cliente.medicacionRegular"
                name="medicacionRegular"
                (change)="onInputChange('medicacionRegular', $event)"
                class="toggle-input">
              <label for="medicacionRegular" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.medicacionRegular">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionMedicacion"
              name="descripcionMedicacion"
              placeholder="Lista tus medicamentos..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionMedicacion', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionMedicacion && cliente.descripcionMedicacion.length > 0"></label>
            <div class="char-counter">{{(cliente.descripcionMedicacion || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Cirug√≠as -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øHas tenido cirug√≠as?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="cirugias"
                [(ngModel)]="cliente.cirugias"
                name="cirugias"
                (change)="onInputChange('cirugias', $event)"
                class="toggle-input">
              <label for="cirugias" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.cirugias">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionCirugias"
              name="descripcionCirugias"
              placeholder="Explica qu√© cirug√≠as has tenido..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionCirugias', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionCirugias && cliente.descripcionCirugias.length > 0"></label>
            <div class="char-counter">{{(cliente.descripcionCirugias || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Lesiones -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øTienes lesiones?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="lesiones"
                [(ngModel)]="cliente.lesiones"
                name="lesiones"
                (change)="onInputChange('lesiones', $event)"
                class="toggle-input">
              <label for="lesiones" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <ion-item *ngIf="cliente.lesiones">
          <div class="textarea-wrapper">
            <textarea 
              class="native-textarea"
              [(ngModel)]="cliente.descripcionLesiones"
              name="descripcionLesiones"
              placeholder="Explica tus lesiones actuales..."
              maxlength="500"
              rows="3"
              (input)="onInputChange('descripcionLesiones', $event)">
            </textarea>
            <label class="floating-label" [class.active]="cliente.descripcionLesiones && cliente.descripcionLesiones.length > 0"></label>
            <div class="char-counter">{{(cliente.descripcionLesiones || '').length}}/500</div>
          </div>
        </ion-item>

        <!-- Fumar -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øFumas regularmente?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="fuma"
                [(ngModel)]="cliente.fuma"
                name="fuma"
                (change)="onInputChange('fuma', $event)"
                class="toggle-input">
              <label for="fuma" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>

        <!-- Alcohol -->
        <ion-item>
          <div class="toggle-question">
            <label class="question-label">¬øConsumes alcohol?</label>
            <div class="toggle-switch">
              <input 
                type="checkbox" 
                id="alcohol"
                [(ngModel)]="cliente.alcohol"
                name="alcohol"
                (change)="onInputChange('alcohol', $event)"
                class="toggle-input">
              <label for="alcohol" class="toggle-label">
              </label>
            </div>
          </div>
        </ion-item>
      </ion-list>

      <div class="step-buttons">
        <ion-button class="back-button" (click)="prevStep()">
          Anterior
        </ion-button>
        <ion-button class="next-button" (click)="nextStep()">
          Siguiente
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Paso 4: Confirmaci√≥n -->
  <ion-card *ngIf="currentStep === 4" [class]="animationClass" class="step-container confirmation-step">
    <ion-card-header>
      <ion-card-title>
        Confirmar Registro
      </ion-card-title>
    </ion-card-header>
    
    <ion-card-content class="confirmation-content">
      <!-- Informaci√≥n Personal -->
      <div class="info-section personal-info">
        <div class="section-header">
          <h3>üë§ Informaci√≥n Personal</h3>
        </div>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Nombre y apellido</span>
            <span class="info-value">{{cliente.nombre}} {{cliente.apellido}}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Edad</span>
            <span class="info-value">{{cliente.edad}} a√±os</span>
          </div>
          <div class="info-item">
            <span class="info-label">Email</span>
            <span class="info-value">{{cliente.correo}}</span>
          </div>
          <div class="info-item">
            <span class="info-label">G√©nero</span>
            <span class="info-value">{{cliente.genero}}</span>
          </div>
        </div>
      </div>

      <!-- Informaci√≥n F√≠sica -->
      <div class="info-section physical-info">
        <div class="section-header">
          <h3>üí™ Informaci√≥n F√≠sica</h3>
        </div>
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Peso</span>
            <span class="info-value">{{cliente.peso}} kg</span>
          </div>
          <div class="info-item">
            <span class="info-label">Altura</span>
            <span class="info-value">{{cliente.altura}} cm</span>
          </div>
          <div class="info-item">
            <span class="info-label">Objetivos</span>
            <span class="info-value">{{cliente.objetivo}}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Nivel de Actividad</span>
            <span class="info-value">{{cliente.nivelActividad}}</span>
          </div>
          <div class="info-item">
            <span class="info-label">Horas de Sue√±o</span>
            <span class="info-value">{{cliente.horasSueno}}</span>
          </div>
        </div>
      </div>

      <!-- Condiciones M√©dicas -->
      <div class="info-section medical-info" *ngIf="hasAnyMedicalCondition()">
        <div class="section-header">
          <h3>‚ù§Ô∏è Condiciones M√©dicas</h3>
        </div>
        <div class="medical-conditions">
          <!-- Lista directa de condiciones m√©dicas activas -->
          <div class="selected-conditions">
            <ion-item *ngIf="cliente.enfermedadCronica" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Enfermedad cr√≥nica</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.diabetes" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Diabetes</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.hipotension" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Hipotensi√≥n</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.hipotiroide" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Hipotiroides</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.hipotiroidismo" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Hipotiroidismo</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.medicacionRegular" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Medicaci√≥n regular</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.cirugias" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Cirug√≠as</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.lesiones" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Lesiones</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.fuma" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Fumador</ion-label>
            </ion-item>
            <ion-item *ngIf="cliente.alcohol" lines="none">
              <ion-icon name="checkmark-circle" color="success" slot="start"></ion-icon>
              <ion-label>Consumo de alcohol</ion-label>
            </ion-item>
          </div>
        </div>
      </div>

      <div class="step-buttons">
        <ion-button class="back-button" (click)="prevStep()">
          Anterior
        </ion-button>
        <ion-button 
          class="next-button" 
          (click)="onSubmit()" 
          [disabled]="isSubmitting">
          Completar
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Pantalla de √âxito -->
  <ion-card *ngIf="showSuccess">
    <ion-card-content class="ion-text-center">
      <ion-icon name="checkmark-circle" color="success" style="font-size: 4rem;"></ion-icon>
      <h2>¬°Registro Exitoso!</h2>
      <p>Tu cuenta ha sido creada correctamente.</p>
      <p>Tu c√≥digo QR se generar√° autom√°ticamente.</p>
      <p><small>Ser√°s redirigido al login en unos segundos...</small></p>
      
      <ion-button expand="full" (click)="goToLogin()" color="success">
        Ir al Login Ahora
      </ion-button>
    </ion-card-content>
  </ion-card>

  </div>
</ion-content>

<!-- Spinner de carga centrado - fuera del ion-content -->
<div class="loading-overlay" *ngIf="showSpinner">
  <div class="spinner-container">
    <ion-spinner name="crescent" class="custom-spinner"></ion-spinner>
    <p class="loading-text">Registrando tu cuenta...</p>
  </div>
</div>